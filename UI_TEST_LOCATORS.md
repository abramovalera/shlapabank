# UI: локаторы для E2E-тестов

Анализ готовности UI к тестированию и рекомендации по локаторам.

---

## Текущее состояние

### Что есть (стабильные локаторы)

**Страница входа (index.html):**
| Элемент | Локатор | Примечание |
|---------|---------|------------|
| Поле логина | `#login` | Ок |
| Поле пароля | `#password` | Ок |
| Кнопка входа | `#loginForm .submit-btn` | Нет id у кнопки |
| Форма регистрации | `#registerForm` | Ок |
| Логин регистрации | `#regLogin` | Ок |
| Пароль регистрации | `#regPassword` | Ок |
| Ошибка логина | `#loginError` | Ок |
| Ошибка регистрации | `#registerError` | Ок |
| Ссылка «Зарегистрироваться» | `#linkToRegister` | Ок |
| Ссылка «Вернуться ко входу» | `#linkToLogin` | Ок |

**Дашборд (dashboard.html):**
| Элемент | Локатор | Примечание |
|---------|---------|------------|
| Выход | `#logoutBtn` | Ок |
| Аватар/профиль | `#userAvatar` | Ок |
| Логотип-шляпа (cheat) | `#hatLogo` | Ок |
| Список счетов | `#accountsList` | Ок |
| Кнопка «Открыть счёт» | `#createAccountForm` или `.accounts-primary-btn` | Ок |
| Вкладки: Главная, Платежи, Чат, Ещё | `[data-page-target="home"]` и т.д. | Ок |
| Кнопки переводов | `#homeTransferOwnBtn`, `#homeTransferByAccountBtn`, `#homeTransferByPhoneBtn`, `#homeExchangeBtn` | Ок |
| Формы платежей | `#mobileForm`, `#vendorForm` | Ок |
| Модалки | `#homeTransferModal`, `#otpModal`, `#confirmCloseModal`, `#cheatModal` и т.д. | Ок |
| Toast | `#toast` | Ок |

---

## Проблемные места

### 1. Нет `data-testid`

Стандартная практика для E2E — атрибут `data-testid` (или `data-qa`). Сейчас его нет. Тесты вынуждены опираться на `id` (который может меняться) или текст/классы.

### 2. Динамический контент без устойчивых атрибутов

**Карточки счетов:**
- Рендерятся в JS, класс `account-item`
- Есть `data-close-id` на кнопке «Закрыть» — можно найти счёт по id
- Кнопки «Пополнить» на карточках нет — пополнение только через читерскую шляпу (Helper) или админа
- Добавлен `data-account-id` на `.account-item` — можно искать карточку по id счёта

**Транзакции:**
- Список в `#recentTransactions` — элементы без id, только классы (`recent-item` и т.д.)
- Нет `data-transaction-id` — нельзя проверить конкретную операцию

**Опции в select:**
- Заполняются динамически, value = id счёта/провайдера — ок для выбора по value

### 3. Неочевидные локаторы

| Что | Проблема |
|-----|----------|
| Кнопка «Войти» | `#loginForm button[type="submit"]` или `.submit-btn` — нет уникального id |
| Кнопка «Зарегистрироваться» | `#registerForm .submit-btn` |
| — | Модалка пополнения удалена; пополнение через читерскую шляпу |
| Кнопка «Перевести» | В каждой форме своя: `#homeTransferForm`, `#homeByAccountForm` и т.д. — кнопка без id |
| Категории платежей | `[data-pay-target="mobile"]` — ок, но «Интернет», «ЖКХ» и т.д. ведут в одну форму vendor с разными провайдерами |
| Пустое состояние счетов | Текст «Нет Активных Счетов» в `<p class="empty">` — нет id, только текст |

### 4. OTP-модалка

- Поля: `#otpDigit1` … `#otpDigit4` — ок
- Кнопка «Вставить код» из preview — генерируется в JS, класс `.otp-preview-code`, `data-otp-code` — ок для клика
- Кнопка «Отмена» — `#otpCancel` (но в разметке её нет, только в otpModal; проверю)

### 5. Модалка открытия счёта

- Появляется при сабмите `#createAccountForm` — но сабмит открывает модалку `#openAccountModal`, а не сразу создаёт счёт
- Селекты: `#openAccountType`, `#openAccountCurrency`
- Кнопка «Открыть счёт»: `#openAccountOk`

---

## Рекомендации

### Минимум для комфортных UI-тестов

1. **Добавить `data-testid`** на ключевые интерактивные элементы:
   - `data-testid="btn-login"`, `data-testid="btn-register"`
   - `data-testid="btn-logout"`, `data-testid="btn-hat-cheat"`
   - `data-testid="btn-transfer-own"`, `data-testid="btn-transfer-by-account"` и т.д.
   - `data-testid="modal-otp"`
   - `data-testid="toast"`

2. **Карточки счетов:** `data-account-id` на `.account-item`. Кнопки «Пополнить» нет — пополнение через читерскую шляпу.

3. **Формы:** дать id кнопкам submit — например `id="loginSubmit"`, `id="topupSubmit"`.

4. **Пустые состояния:** обернуть в элемент с `data-testid="empty-accounts"` и т.д.

### Что можно тестировать уже сейчас

- Логин/регистрация — по `#login`, `#password`, `#loginForm`
- Переход на дашборд — по `#logoutBtn` (признак, что залогинены)
- Открытие модалок переводов — по `#homeTransferOwnBtn` и т.д.
- Заполнение форм — по id полей (`#homeTransferAmount`, `#mobilePhone` и т.д.)
- Toast — по `#toast` и классу `show`
- Cheat-окно — по `#hatLogo`

### Чего лучше избегать

- Локаторы по тексту кнопок (меняется при локализации)
- Сложные цепочки `.parent().parent()` — хрупко при изменении вёрстки
- Классы вида `btn`, `btn light` — слишком общие

---

## Итог

| Критерий | Оценка |
|----------|--------|
| Понятные id на формах и полях | ✅ Хорошо |
| data-testid для E2E | ✅ Добавлены на ключевые элементы |
| Стабильные локаторы для динамического контента | ✅ data-account-id, data-close-id на карточках |
| Кнопки submit с id | ⚠️ Нет |
| Toast и модалки | ✅ Есть id |

**Вывод:** Писать UI-тесты можно. Добавлены `data-testid` на ключевые элементы (логин, регистрация, дашборд, toast), `data-account-id` на карточки счетов. Пополнение — через читерскую шляпу. Рекомендуется использовать `[data-testid="..."]` в E2E-тестах.

---

## Список data-testid (для копирования в тесты)

**Страница входа:**
- `input-login` — поле логина
- `input-password` — поле пароля
- `btn-login` — кнопка «Войти»
- `link-register` — ссылка «Зарегистрироваться»
- `login-error` — блок ошибки логина
- `input-reg-login` — логин на форме регистрации
- `input-reg-password` — пароль на форме регистрации
- `btn-register` — кнопка «Зарегистрироваться»
- `register-error` — блок ошибки регистрации

**Дашборд:**
- `btn-logout` — кнопка «Выйти»
- `btn-hat-cheat` — логотип-шляпа (cheat-окно)
- `btn-transfer-own` — «Между своими счетами»
- `btn-open-account` — «Открыть счёт»
- `toast` — уведомления (проверять `.show` для видимости)
- `empty-accounts` — пустое состояние «Нет активных счетов»

**Карточки счетов (динамические):**
- `[data-account-id="123"]` — контейнер счёта
- Пополнение счёта — через читерскую шляпу (клик по логотипу)
- `[data-testid="btn-account-close"]` — «Закрыть»
