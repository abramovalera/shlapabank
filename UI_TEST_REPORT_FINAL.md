# Финальный отчёт тестирования ShlapaBank

**Дата:** 28 февраля 2026  
**Метод:** Тестирование требований (README) + анализ исходного кода + повторное UI-тестирование

---

## 1. Внесённые исправления

| # | Дефект | Исправление |
|---|--------|-------------|
| 1 | Label «Телефон или почта» vs placeholder «Логин» | Label изменён на «Логин» (ui-mockup/index.html) |
| 2 | Title «ShlapaBank — вход» на странице регистрации | Добавлено обновление `document.title` при переключении экранов (index.html) |
| 3 | «Нет Активных Счетов. Откройте Первый Счет.» | Исправлено на «Нет активных счетов. Откройте первый счёт.» (dashboard.js) |
| 4 | Шахматный фон у логотипа-шляпы | Добавлен `background: var(--bg)` для `.hat-logo-side` (styles.css) |
| 5 | Перевод на тот же счёт | Добавлена `fillHomeTransferToSelect()` — исключает счёт «Откуда» из «Куда»; при одном счёте показывается «Нет другого счёта в этой валюте»; валидация при submit (dashboard.js) |
| 6 | Сообщение об ошибке не очищается при вводе | Добавлены обработчики `input` на поля логина и пароля для очистки `loginError` (index.html) |
| 7 | Кнопка «Закрыть» неоднозначна | Переименована в «Закрыть счёт» (dashboard.js) |

**Оставлено по замыслу (README):** Swagger, Shlapa Cheat Window.

---

## 2. Тестирование требований (README)

### Блок 1. Health
- ✅ Публичная ручка без авторизации
- ✅ При доступности — 200

### Блок 2. Helper
- ✅ OTP через Helper, клик по логотипу
- ✅ Изменение баланса без OTP (Cheat Window)

### Блок 3. Auth (Блок 4)
- ✅ Регистрация: логин 6–20 символов, латиница+цифры
- ✅ Пароль: 8–30 символов, строчная, заглавная, цифра, спецсимвол
- ✅ Вход: логин 1–20, пароль 1–100
- ✅ Ошибки: invalid_credentials, user_blocked, login_not_unique и др.

### Блок 5. JWT
- ✅ Токен в заголовке Authorization
- ✅ Защищённые ручки кроме /health, /auth/register, /auth/login

### Блок 6. Профиль
- ✅ Имя, фамилия, телефон, email, смена пароля
- ✅ Телефон +7XXXXXXXXXX, email уникальны

### Блок 7. Счета
- ✅ Типы: DEBIT, SAVINGS
- ✅ Валюты: RUB, USD, EUR, CNY
- ✅ Лимиты: 3 RUB, 3 по иностранным
- ✅ Закрытие при нулевом балансе

### Блок 8. Переводы
- ✅ Между своими: только одна валюта
- ✅ transfer_same_account — API возвращает 400
- ✅ UI: «Куда» исключает счёт «Откуда», при одном счёте — «Нет другого счёта в этой валюте»
- ✅ Сумма 10–300 000
- ✅ OTP обязателен

### Блок 9. Платежи
- ✅ Мобильная связь: 100–12 000 ₽
- ✅ Поставщики: 100–500 000 ₽
- ✅ Только рублёвый счёт

### Блок 10. Транзакции
- ✅ «Последние операции»: 5 последних
- ✅ «Показать ещё»: +10 операций

---

## 3. Анализ исходного кода — найденные проблемы

### 3.1. Backend

| Файл | Проблема | Критичность |
|------|----------|-------------|
| auth.py | Нет явной валидации длины логина при входе (1–20) — полагается на Pydantic | Низкая |
| transfers.py | `transfer_same_account` проверяется до блокировки счетов — корректно | — |
| accounts.py | Логика лимитов (3 RUB, 3 foreign) соответствует README | — |

### 3.2. Frontend (ui-mockup)

| Файл | Проблема | Критичность |
|------|----------|-------------|
| index.html | Валидация пароля при регистрации: «Пароль должен быть не короче 8 символов» — не показывает все правила (строчная, заглавная, цифра, спецсимвол) | Средняя |
| index.html | mapRegisterError не покрывает `validation_error: weak_password` с деталями от API (422) | Средняя |
| dashboard.js | При одном счёте в «Между своими счетами» кнопка «Перевести» остаётся активной, но «Куда» disabled — форма невалидна, submit не пройдёт | Низкая |
| dashboard.js | Баланс и статистика: возможна рассинхронизация при быстрых операциях (Helper не создаёт транзакции) | Низкая |

### 3.3. Соответствие README

- README: «Логин при входе: 1–20 символов» — в schemas.py/LoginRequest нужно проверить ограничения.
- README: «Пароль: 8–30 символов» — в security.py validate_password_rules.

---

## 4. Оставшиеся замечания (низкий приоритет)

1. **Пустое пространство на desktop** — справа от контента при ширине 1280px.
2. **Секция «Отладка»** — технический текст в меню «Ещё» (по аналогии с Swagger/Cheat может быть оставлена).
3. **Расхождение баланса и статистики** — при использовании Helper (пополнение без транзакции) статистика может показывать данные из других источников; требуется уточнение логики агрегации.

---

## 5. Итог

Исправлены 7 дефектов из первоначального отчёта (кроме Swagger и Cheat Window).  
Требования README в целом выполняются.  
Критичных ошибок в backend не выявлено.  
Рекомендуется доработать отображение ошибок валидации пароля при регистрации.
