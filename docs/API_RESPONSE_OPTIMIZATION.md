# Предложение по оптимизации ответов API

Учебный проект: убрать лишние поля, ввести вложенные объекты (сумма + комиссия), сделать ответы «рабочими» и читаемыми.

---

## 1. Транзакция (история, переводы, платежи, пополнение)

### Сейчас
```json
{
  "id": 15,
  "from_account_id": 1,
  "to_account_id": 2,
  "type": "TRANSFER",
  "amount": "1500.00",
  "currency": "RUB",
  "status": "COMPLETED",
  "initiated_by": 7,
  "description": "p2p_transfer",
  "fee": "0.00",
  "created_at": "2026-02-26T12:34:56.000000"
}
```

### Зачем сейчас лишнее
- **id** — нужен для чека (`/transactions/{id}/receipt`) и для отображения «операция №N».
- **from_account_id / to_account_id** — нужны UI, чтобы показать «со счёта ••••3402» и «на счёт ••••1234».
- **initiated_by** — ID пользователя, который инициировал операцию. Для клиента не нужен (всегда «я»), для админа при просмотре чужих транзакций — можно оставить только в админке.

### Варианты оптимизации

**Вариант A — убрать только лишнее, сумма плоская**
- Убрать из ответа для обычного клиента: **initiated_by**.
- Оставить: id, from_account_id, to_account_id, type, currency, status, description, created_at.
- Сумму и комиссию объединить во вложенный объект.

**Вариант B — вложенный объект «деньги» (рекомендуется)**

Структура ответа:
```json
{
  "id": 15,
  "from_account_id": 1,
  "to_account_id": 2,
  "type": "TRANSFER",
  "money": {
    "amount": "1500.00",
    "fee": "0.00",
    "total": "1500.00",
    "currency": "RUB"
  },
  "status": "COMPLETED",
  "description": "p2p_transfer",
  "created_at": "2026-02-26T12:34:56.000000"
}
```
- **initiated_by** — убрать из ответа клиенту (в админке оставить или передавать отдельно).
- **money** — один объект: сумма операции, комиссия, итого к списанию/зачислению, валюта. Удобно и для UI, и для документации.

**Вариант C — минимум полей**
Только то, что реально нужно списку и деталям:
```json
{
  "id": 15,
  "type": "TRANSFER",
  "money": { "amount": "1500.00", "fee": "0.00", "total": "1500.00", "currency": "RUB" },
  "description": "p2p_transfer",
  "created_at": "2026-02-26T12:34:56.000000",
  "from_account_id": 1,
  "to_account_id": 2,
  "status": "COMPLETED"
}
```
Без **initiated_by**. Порядок полей можно зафиксировать в схеме (сначала id, type, money, потом описание и дата, в конце счета и статус).

---

## 2. Счета (GET /accounts, создание счёта, пополнение, helper)

### Сейчас
```json
{
  "id": 1,
  "account_number": "2202000000003402",
  "account_type": "DEBIT",
  "currency": "RUB",
  "balance": "324234199.35",
  "is_primary": false
}
```

### Оптимизация
- Поля все нужны: **id** — для запросов (топан, переводы), **account_number** — маска в UI, **balance** — отображение, **is_primary** — приоритет для зачисления.
- Можно единообразно отдавать **balance** как строку с двумя знаками: `"324234199.35"` (уже так).
- Вложенный объект не обязателен; при желании можно вынести валюту в объект, но для счёта это не даёт большой выгоды.

**Итог:** оставить как есть или только привести формат balance к одному виду.

---

## 3. Профиль (GET/PUT /profile), ответ логина (UserPublic)

### Сейчас (профиль / пользователь)
```json
{
  "id": 7,
  "login": "ivan",
  "email": "ivan@example.com",
  "role": "CLIENT",
  "status": "ACTIVE",
  "first_name": "Иван",
  "last_name": "Петров",
  "phone": "+79001234567"
}
```

### Оптимизация
- Для **профиля** текущего пользователя **id** и **login** полезны (отображение, возможные запросы). **role** и **status** — для UI (кнопки, сообщения).
- Для **учебного** проекта можно упростить ответ профиля до «витрины» без внутренних id, но тогда теряется единообразие с админкой. Рационально оставить текущий набор, убрать только то, что точно не показываем (если такое есть).
- **Вариант:** разделить схему на **ProfileResponse** (то, что видит пользователь в профиле) и **UserPublic** (для админки и регистрации). В ProfileResponse можно не отдавать **id**, если он нигде в UI не используется.

**Итог:** оставить как есть или ввести отдельную минимальную схему только для GET/PUT profile без id (по желанию).

---

## 4. Логин (POST /auth/login)

### Сейчас
```json
{
  "access_token": "...",
  "token_type": "bearer",
  "role": "CLIENT"
}
```

### Оптимизация
Поля все нужны: токен, тип, роль для UI. Менять не обязательно.

---

## 5. Вспомогательные ответы (без схемы)

- **GET /payments/mobile/operators** — `{ "userId": ..., "operators": [...], "amountRangeRub": { "min", "max" } }`. **userId** для учебного проекта лишний; достаточно `operators` и `amountRangeRub`.
- **GET /payments/vendor/providers** — аналогично: убрать **userId**, оставить **providers** и **amountRangeRub**.
- **GET /transfers/rates** — `{ "userId", "base", "toRub" }`. Убрать **userId**, оставить **base** и **toRub**.
- **GET /transfers/daily-usage** — уже нормально: `{ "limits": { "perCurrency": [...] } }`.
- **GET /helper/otp/preview** — убрать **userId**, оставить **otp**, **ttlSeconds**, **message**.

**Итог:** во всех таких ответах убрать **userId** (и аналогичные служебные id), оставить только данные, нужные фронту.

---

## 6. Админка

- **GET /admin/users** — список UserPublic: id нужен для block/unblock/delete и просмотра транзакций. Оставить.
- **GET /admin/users/{id}/transactions** — те же транзакции; оптимизация как в п. 1 (вложенный **money**, без **initiated_by** в ответе клиенту; для админа **initiated_by** можно оставить или вынести в отдельное поле «инициатор»).
- **GET /admin/users/{id}/banks** — `{ "bank_codes": [...] }`. Норм.
- **PUT /admin/users/{id}/banks** — `{ "detail", "bank_codes" }`. Норм.

---

## 7. Проверки переводов

- **GET /transfers/by-account/check** — `{ "found": true, "masked": "••••1234" }`. Минимум, менять не нужно.
- **GET /transfers/by-phone/check** — `{ "inOurBank": true, "availableBanks": [{ "id", "label" }] }`. Норм.

---

## 8. Сводная таблица предложений

| Ручка / группа | Что убрать | Что изменить / ввести |
|----------------|------------|---------------------------|
| Транзакции (все ответы с TransactionPublic) | **initiated_by** (в ответе клиенту) | Ввести объект **money**: `{ "amount", "fee", "total", "currency" }`, убрать с верхнего уровня отдельные amount, fee, currency. |
| GET /accounts, создание счёта, topup (счёт) | — | Только единый формат balance (строка с 2 знаками). |
| GET /profile, PUT /profile | По желанию id | Оставить как есть или отдельная схема без id. |
| POST /auth/login | — | Без изменений. |
| GET .../operators, .../providers, .../rates, helper/otp/preview | **userId** (и аналоги) | Оставить только данные для UI (operators, ranges, rates, otp, ttl, message). |
| Админ: пользователи, транзакции | — | Транзакции — та же схема с **money**; для админа при необходимости оставить initiated_by или заменить на login. |

---

## 9. Рекомендуемый порядок внедрения

1. **Транзакция:** ввести схему с вложенным **money** (amount, fee, total, currency) и убрать **initiated_by** из ответа клиенту. Обновить фронт: брать сумму/комиссию из `tx.money`.
2. **Вспомогательные ответы:** убрать **userId** из operators, providers, rates, helper/otp.
3. По желанию: отдельная схема ответа профиля и минификация полей в других ответах.

После этого ответы станут «нормальными рабочими»: без лишних id в клиентских ответах, с одной структурой «деньги» (сумма + комиссия + итог + валюта) в транзакциях.
